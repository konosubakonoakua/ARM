# qemu i2c
## add device
Use `-device` command to add device.
```shell
qemu-system-arm -M orangepi-pc \
  -m 1G \
  -sd sdcard.img \
  -serial stdio \
  -monitor telnet:127.0.0.1:1234,server,nowait \
  -device i2c-echo,address=0x33 \
  -device ssd0303,address=0x3c
```
## ssd0303
The device is implemented by xilinx in qemu, there are open source drivers for ssd0303, refer to [OSRAMStringDraw](https://github.com/FreeRTOS/FreeRTOS/blob/b9cb18e46e7042d1dc1475bf054cc5278e422d16/FreeRTOS/Demo/CORTEX_LM3S811_GCC/hw_include/osram96x16.c#L587).

The main logic looks like:
```c
OSRAMStringDraw(const char *pcStr, unsigned long ulX, unsigned long ulY)
{
    OSRAMWriteFirst(0x80); OSRAMWriteByte((ulY == 0) ? 0xb0 : 0xb1);
    OSRAMWriteByte(0x80); OSRAMWriteByte((ulX + 36) & 0x0f);
    OSRAMWriteByte(0x80); OSRAMWriteByte(0x10 | (((ulX + 36) >> 4) & 0x0f));
    OSRAMWriteByte(0x40);
    while(*pcStr != 0)
    {
        if(ulX <= 90)
        {
            // g_pucFont is font array
            OSRAMWriteArray(g_pucFont[*pcStr - ' '], 5);
            if((ulX == 90) || (pcStr[1] == 0)) { OSRAMWriteFinal(0x00); return; }
            OSRAMWriteByte(0x00);
        }
        else
        {
            OSRAMWriteArray(g_pucFont[*pcStr - ' '], 95 - ulX);
            OSRAMWriteFinal(g_pucFont[*pcStr - ' '][95 - ulX]);
            return;
        }

        pcStr++;
        ulX += 6;
    }
}
```
The [ssd0303 device code](https://github.com/qemu/qemu/blob/039afc5ef7367fbc8fb475580c291c2655e856cb/hw/display/ssd0303.c#L75) in qemu:
```c
static int ssd0303_send(I2CSlave *i2c, uint8_t data)
{
    ssd0303_state *s = SSD0303(i2c);
    enum ssd0303_cmd old_cmd_state;
    switch (s->mode) {
    case SSD0303_IDLE: DPRINTF("byte 0x%02x\n", data);
        if (data == 0x80) s->mode = SSD0303_CMD;
        else if (data == 0x40) s->mode = SSD0303_DATA;
        else BADF("Unexpected byte 0x%x\n", data);
        break;
    case SSD0303_DATA: DPRINTF("data 0x%02x\n", data);
        if (s->col < 132) { s->framebuffer[s->col + s->row * 132] = data; s->col++; s->redraw = 1; }
        break;
    case SSD0303_CMD: old_cmd_state = s->cmd_state; s->cmd_state = SSD0303_CMD_NONE;
        switch (old_cmd_state) {
        case SSD0303_CMD_NONE: DPRINTF("cmd 0x%02x\n", data); s->mode = SSD0303_IDLE;
            switch (data) {
            case 0x00 ... 0x0f: /* Set lower column address.  */  s->col = (s->col & 0xf0) | (data & 0xf); break;
            case 0x10 ... 0x20: /* Set higher column address.  */ s->col = (s->col & 0x0f) | ((data & 0xf) << 4); break;
            case 0x40 ... 0x7f: /* Set start line.  */            s->start_line = 0; break;
            case 0x81: /* Set contrast (Ignored).  */             s->cmd_state = SSD0303_CMD_SKIP1; break;
            case 0xa0: /* Mirror off.  */                         s->mirror = 0; break;
            case 0xa1: /* Mirror off.  */                         s->mirror = 1; break;
            case 0xa4: /* Entire display off.  */                 s->flash = 0; break;
            case 0xa5: /* Entire display on.  */                  s->flash = 1; break;
            case 0xa6: /* Inverse off.  */                        s->inverse = 0; break;
            case 0xa7: /* Inverse on.  */                         s->inverse = 1; break;
            case 0xa8: /* Set multiplied ratio (Ignored).  */     s->cmd_state = SSD0303_CMD_SKIP1; break;
            case 0xad: /* DC-DC power control.  */                s->cmd_state = SSD0303_CMD_SKIP1; break;
            case 0xae: /* Display off.  */                        s->enabled = 0; break;
            case 0xaf: /* Display on.  */                         s->enabled = 1; break;
            case 0xb0 ... 0xbf: /* Set Page address.  */          s->row = data & 7; break;
            case 0xc0 ... 0xc8: /* Set COM output direction (Ignored).  */ break;
            case 0xd3: /* Set display offset (Ignored).  */       s->cmd_state = SSD0303_CMD_SKIP1; break;
            case 0xd5: /* Set display clock (Ignored).  */        s->cmd_state = SSD0303_CMD_SKIP1; break;
            case 0xd8: /* Set color and power mode (Ignored).*/   s->cmd_state = SSD0303_CMD_SKIP1; break;
            case 0xd9: /* Set pre-charge period (Ignored).  */    s->cmd_state = SSD0303_CMD_SKIP1; break;
            case 0xda: /* Set COM pin configuration (Ignored).*/  s->cmd_state = SSD0303_CMD_SKIP1; break;
            case 0xdb: /* Set VCOM dselect level (Ignored).  */   s->cmd_state = SSD0303_CMD_SKIP1; break;
            case 0xe3: /* no-op.  */ break;
            default: BADF("Unknown command: 0x%x\n", data);
            }
            break;
        case SSD0303_CMD_SKIP1: DPRINTF("skip 0x%02x\n", data); break;
        }
        break;
    }
    return 0;
}
```

After comparing the above two codes, I made up some linux shell code to print strings on the simulated oled in qemu window.

```shell
# /root/oled.sh
font35() {
	# 3x5 font
	local char="$1"
	case "$char" in
	" ") echo "0x00 0x00 0x00" ;;  # 0x20 32
	"!") echo "0x00 0x2e 0x00" ;;  # 0x21 33 !
	'"') echo "0x06 0x00 0x06" ;;  # 0x22 34 "
	"#") echo "0x3e 0x14 0x3e" ;;  # 0x23 35 #
	"$") echo "0x0c 0x36 0x18" ;;  # 0x24 36 $
	"%") echo "0x32 0x08 0x26" ;;  # 0x25 37 %
	"&") echo "0x14 0x2a 0x34" ;;  # 0x26 38 &
	"'") echo "0x00 0x06 0x00" ;;  # 0x27 39 '
	"(") echo "0x00 0x1c 0x22" ;;  # 0x28 40 (
	")") echo "0x22 0x1c 0x00" ;;  # 0x29 41 )
	"*") echo "0x14 0x08 0x14" ;;  # 0x2A 42 *
	"+") echo "0x08 0x1c 0x08" ;;  # 0x2B 43 +
	",") echo "0x40 0x60 0x00" ;;  # 0x2C 44
	"-") echo "0x08 0x08 0x08" ;;  # 0x2D 45 -
	".") echo "0x00 0x20 0x00" ;;  # 0x2E 46 .
	"/") echo "0x60 0x1c 0x02" ;;  # 0x2F 47 /
	"0") echo "0x3e 0x22 0x3e" ;;  # 0x30 48 0
	"1") echo "0x24 0x3e 0x20" ;;  # 0x31 49 1
	"2") echo "0x32 0x2a 0x26" ;;  # 0x32 50 2
	"3") echo "0x22 0x2a 0x3e" ;;  # 0x33 51 3
	"4") echo "0x0e 0x08 0x3e" ;;  # 0x34 52 4
	"5") echo "0x2e 0x2a 0x3a" ;;  # 0x35 53 5
	"6") echo "0x3e 0x2a 0x3a" ;;  # 0x36 54 6
	"7") echo "0x02 0x3a 0x06" ;;  # 0x37 55 7
	"8") echo "0x3e 0x2a 0x3e" ;;  # 0x38 56 8
	"9") echo "0x2e 0x2a 0x3e" ;;  # 0x39 57 9
	":") echo "0x00 0x14 0x00" ;;  # 0x3A 58 :
	";") echo "0x40 0x64 0x00" ;;  # 0x3B 59 ;
	"<") echo "0x08 0x14 0x22" ;;  # 0x3C 60 <
	"=") echo "0x14 0x14 0x14" ;;  # 0x3D 61 =
	">") echo "0x22 0x14 0x08" ;;  # 0x3E 62 >
	"?") echo "0x02 0x2a 0x06" ;;  # 0x3F 63 ?
	"@") echo "0x3e 0x22 0x2e" ;;  # 0x40 64 @
	"A") echo "0x3e 0x0a 0x3e" ;;  # 0x41 65 A
	"B") echo "0x3e 0x2a 0x36" ;;  # 0x42 66 B
	"C") echo "0x3e 0x22 0x22" ;;  # 0x43 67 C
	"D") echo "0x3e 0x22 0x1c" ;;  # 0x44 68 D
	"E") echo "0x3e 0x2a 0x22" ;;  # 0x45 69 E
	"F") echo "0x3e 0x0a 0x02" ;;  # 0x46 70 F
	"G") echo "0x3e 0x22 0x3a" ;;  # 0x47 71 G
	"H") echo "0x3e 0x08 0x3e" ;;  # 0x48 72 H
	"I") echo "0x22 0x3e 0x22" ;;  # 0x49 73 I
	"J") echo "0x30 0x20 0x3e" ;;  # 0x4A 74 J
	"K") echo "0x3e 0x08 0x36" ;;  # 0x4B 75 K
	"L") echo "0x3e 0x20 0x20" ;;  # 0x4C 76 L
	"M") echo "0x3e 0x04 0x3e" ;;  # 0x4D 77 M
	"N") echo "0x3c 0x08 0x1e" ;;  # 0x4E 78 N
	"O") echo "0x3e 0x22 0x3e" ;;  # 0x4F 79 O
	"P") echo "0x3e 0x0a 0x0e" ;;  # 0x50 80 P
	"Q") echo "0x3e 0x22 0x7e" ;;  # 0x51 81 Q
	"R") echo "0x3e 0x0a 0x34" ;;  # 0x52 82 R
	"S") echo "0x2e 0x2a 0x3a" ;;  # 0x53 83 S
	"T") echo "0x02 0x3e 0x02" ;;  # 0x54 84 T
	"U") echo "0x3e 0x20 0x3e" ;;  # 0x55 85 U
	"V") echo "0x1e 0x20 0x1e" ;;  # 0x56 86 V
	"W") echo "0x3e 0x10 0x3e" ;;  # 0x57 87 W
	"X") echo "0x36 0x08 0x36" ;;  # 0x58 88 X
	"Y") echo "0x06 0x38 0x06" ;;  # 0x59 89 Y
	"Z") echo "0x32 0x2a 0x26" ;;  # 0x5A 90 Z
	"[") echo "0x00 0x3e 0x22" ;;  # 0x5B 91 [
	"\\") echo "0x02 0x1c 0x60" ;; # 0x5C 92 \
	"]") echo "0x22 0x3e 0x00" ;;  # 0x5D 93 ]
	"^") echo "0x04 0x02 0x04" ;;  # 0x5E 94 ^
	"_") echo "0x40 0x40 0x40" ;;  # 0x5F 95 _
	"\`") echo "0x00 0x02 0x00" ;; # 0x60 96 `
	"a") echo "0x3e 0x0a 0x3e" ;;  # 0x61 97 a
	"b") echo "0x3e 0x2a 0x36" ;;  # 0x62 98 b
	"c") echo "0x3e 0x22 0x22" ;;  # 0x63 99 c
	"d") echo "0x3e 0x22 0x1c" ;;  # 0x64 100 d
	"e") echo "0x3e 0x2a 0x22" ;;  # 0x65 101 e
	"f") echo "0x3e 0x0a 0x02" ;;  # 0x66 102 f
	"g") echo "0x3e 0x22 0x3a" ;;  # 0x67 103 g
	"h") echo "0x3e 0x08 0x3e" ;;  # 0x68 104 h
	"i") echo "0x22 0x3e 0x22" ;;  # 0x69 105 i
	"j") echo "0x30 0x20 0x3e" ;;  # 0x6A 106 j
	"k") echo "0x3e 0x08 0x36" ;;  # 0x6B 107 k
	"l") echo "0x3e 0x20 0x20" ;;  # 0x6C 108 l
	"m") echo "0x3e 0x04 0x3e" ;;  # 0x6D 109 m
	"n") echo "0x3c 0x08 0x1e" ;;  # 0x6E 110 n
	"o") echo "0x3e 0x22 0x3e" ;;  # 0x6F 111 o
	"p") echo "0x3e 0x0a 0x0e" ;;  # 0x70 112 p
	"q") echo "0x3e 0x22 0x7e" ;;  # 0x71 113 q
	"r") echo "0x3e 0x0a 0x34" ;;  # 0x72 114 r
	"s") echo "0x2e 0x2a 0x3a" ;;  # 0x73 115 s
	"t") echo "0x02 0x3e 0x02" ;;  # 0x74 116 t
	"u") echo "0x3e 0x20 0x3e" ;;  # 0x75 117 u
	"v") echo "0x1e 0x20 0x1e" ;;  # 0x76 118 v
	"w") echo "0x3e 0x10 0x3e" ;;  # 0x77 119 w
	"x") echo "0x36 0x08 0x36" ;;  # 0x78 120 x
	"y") echo "0x06 0x38 0x06" ;;  # 0x79 121 y
	"z") echo "0x32 0x2a 0x26" ;;  # 0x7A 122 z
	"{") echo "0x08 0x3e 0x22" ;;  # 0x7B 123 {
	"|") echo "0x00 0x7e 0x00" ;;  # 0x7C 124 |
	"}") echo "0x22 0x3e 0x08" ;;  # 0x7D 125 }
	"~") echo "0x02 0x06 0x04" ;;  # 0x7E 126 ~
	*) echo "Subarray not defined for '$char'" ;;
	esac
}

font57() {
	# 5x7 font
	local char="$1"
	case "$char" in
	" ") echo "0x00 0x00 0x00 0x00 0x00" ;;
	"!") echo "0x00 0x00 0x4f 0x00 0x00" ;;
	'"') echo "0x00 0x07 0x00 0x07 0x00" ;;
	"#") echo "0x14 0x7f 0x14 0x7f 0x14" ;;
	"$") echo "0x24 0x2a 0x7f 0x2a 0x12" ;;
	"%") echo "0x23 0x13 0x08 0x64 0x62" ;;
	"&") echo "0x36 0x49 0x55 0x22 0x50" ;;
	"'") echo "0x00 0x05 0x03 0x00 0x00" ;;
	"(") echo "0x00 0x1c 0x22 0x41 0x00" ;;
	")") echo "0x00 0x41 0x22 0x1c 0x00" ;;
	"*") echo "0x14 0x08 0x3e 0x08 0x14" ;;
	"+") echo "0x08 0x08 0x3e 0x08 0x08" ;;
	",") echo "0x00 0x50 0x30 0x00 0x00" ;;
	"-") echo "0x08 0x08 0x08 0x08 0x08" ;;
	".") echo "0x00 0x60 0x60 0x00 0x00" ;;
	"/") echo "0x20 0x10 0x08 0x04 0x02" ;;
	"0") echo "0x3e 0x51 0x49 0x45 0x3e" ;;
	"1") echo "0x00 0x42 0x7f 0x40 0x00" ;;
	"2") echo "0x42 0x61 0x51 0x49 0x46" ;;
	"3") echo "0x21 0x41 0x45 0x4b 0x31" ;;
	"4") echo "0x18 0x14 0x12 0x7f 0x10" ;;
	"5") echo "0x27 0x45 0x45 0x45 0x39" ;;
	"6") echo "0x3c 0x4a 0x49 0x49 0x30" ;;
	"7") echo "0x01 0x71 0x09 0x05 0x03" ;;
	"8") echo "0x36 0x49 0x49 0x49 0x36" ;;
	"9") echo "0x06 0x49 0x49 0x29 0x1e" ;;
	":") echo "0x00 0x36 0x36 0x00 0x00" ;;
	";") echo "0x00 0x56 0x36 0x00 0x00" ;;
	"<") echo "0x08 0x14 0x22 0x41 0x00" ;;
	"=") echo "0x14 0x14 0x14 0x14 0x14" ;;
	">") echo "0x00 0x41 0x22 0x14 0x08" ;;
	"?") echo "0x02 0x01 0x51 0x09 0x06" ;;
	"@") echo "0x32 0x49 0x79 0x41 0x3e" ;;
	"A") echo "0x7e 0x11 0x11 0x11 0x7e" ;;
	"B") echo "0x7f 0x49 0x49 0x49 0x36" ;;
	"C") echo "0x3e 0x41 0x41 0x41 0x22" ;;
	"D") echo "0x7f 0x41 0x41 0x22 0x1c" ;;
	"E") echo "0x7f 0x49 0x49 0x49 0x41" ;;
	"F") echo "0x7f 0x09 0x09 0x09 0x01" ;;
	"G") echo "0x3e 0x41 0x49 0x49 0x7a" ;;
	"H") echo "0x7f 0x08 0x08 0x08 0x7f" ;;
	"I") echo "0x00 0x41 0x7f 0x41 0x00" ;;
	"J") echo "0x20 0x40 0x41 0x3f 0x01" ;;
	"K") echo "0x7f 0x08 0x14 0x22 0x41" ;;
	"L") echo "0x7f 0x40 0x40 0x40 0x40" ;;
	"M") echo "0x7f 0x02 0x0c 0x02 0x7f" ;;
	"N") echo "0x7f 0x04 0x08 0x10 0x7f" ;;
	"O") echo "0x3e 0x41 0x41 0x41 0x3e" ;;
	"P") echo "0x7f 0x09 0x09 0x09 0x06" ;;
	"Q") echo "0x3e 0x41 0x51 0x21 0x5e" ;;
	"R") echo "0x7f 0x09 0x19 0x29 0x46" ;;
	"S") echo "0x46 0x49 0x49 0x49 0x31" ;;
	"T") echo "0x01 0x01 0x7f 0x01 0x01" ;;
	"U") echo "0x3f 0x40 0x40 0x40 0x3f" ;;
	"V") echo "0x1f 0x20 0x40 0x20 0x1f" ;;
	"W") echo "0x3f 0x40 0x38 0x40 0x3f" ;;
	"X") echo "0x63 0x14 0x08 0x14 0x63" ;;
	"Y") echo "0x07 0x08 0x70 0x08 0x07" ;;
	"Z") echo "0x61 0x51 0x49 0x45 0x43" ;;
	"[") echo "0x00 0x7f 0x41 0x41 0x00" ;;
	"\\") echo "0x02 0x04 0x08 0x10 0x20" ;;
	"]") echo "0x00 0x41 0x41 0x7f 0x00" ;;
	"^") echo "0x04 0x02 0x01 0x02 0x04" ;;
	"_") echo "0x40 0x40 0x40 0x40 0x40" ;;
	"\`") echo "0x00 0x01 0x02 0x04 0x00" ;;
	"a") echo "0x20 0x54 0x54 0x54 0x78" ;;
	"b") echo "0x7f 0x48 0x44 0x44 0x38" ;;
	"c") echo "0x38 0x44 0x44 0x44 0x20" ;;
	"d") echo "0x38 0x44 0x44 0x48 0x7f" ;;
	"e") echo "0x38 0x54 0x54 0x54 0x18" ;;
	"f") echo "0x08 0x7e 0x09 0x01 0x02" ;;
	"g") echo "0x0c 0x52 0x52 0x52 0x3e" ;;
	"h") echo "0x7f 0x08 0x04 0x04 0x78" ;;
	"i") echo "0x00 0x44 0x7d 0x40 0x00" ;;
	"j") echo "0x20 0x40 0x44 0x3d 0x00" ;;
	"k") echo "0x7f 0x10 0x28 0x44 0x00" ;;
	"l") echo "0x00 0x41 0x7f 0x40 0x00" ;;
	"m") echo "0x7c 0x04 0x18 0x04 0x78" ;;
	"n") echo "0x7c 0x08 0x04 0x04 0x78" ;;
	"o") echo "0x38 0x44 0x44 0x44 0x38" ;;
	"p") echo "0x7c 0x14 0x14 0x14 0x08" ;;
	"q") echo "0x08 0x14 0x14 0x18 0x7c" ;;
	"r") echo "0x7c 0x08 0x04 0x04 0x08" ;;
	"s") echo "0x48 0x54 0x54 0x54 0x20" ;;
	"t") echo "0x04 0x3f 0x44 0x40 0x20" ;;
	"u") echo "0x3c 0x40 0x40 0x20 0x7c" ;;
	"v") echo "0x1c 0x20 0x40 0x20 0x1c" ;;
	"w") echo "0x3c 0x40 0x30 0x40 0x3c" ;;
	"x") echo "0x44 0x28 0x10 0x28 0x44" ;;
	"y") echo "0x0c 0x50 0x50 0x50 0x3c" ;;
	"z") echo "0x44 0x64 0x54 0x4c 0x44" ;;
	"{") echo "0x00 0x08 0x36 0x41 0x00" ;;
	"|") echo "0x00 0x00 0x7f 0x00 0x00" ;;
	"}") echo "0x00 0x41 0x36 0x08 0x00" ;;
	"~") echo "0x02 0x01 0x02 0x04 0x02" ;;
	*) echo "Subarray not defined for '$char'" ;;
	esac
}

font55() {
	# 5x5 font
	local char="$1"
	case "$char" in
	" ") echo "0x00 0x00 0x00 0x00 0x00" ;;  # 0x20 32
	"!") echo "0x5c 0x00 0x00 0x00 0x00" ;;  # 0x21 33 !
	'"') echo "0x06 0x00 0x06 0x00 0x00" ;;  # 0x22 34 "
	"#") echo "0x28 0x7c 0x28 0x7c 0x28" ;;  # 0x23 35 #
	"$") echo "0x5c 0x54 0xfe 0x54 0x74" ;;  # 0x24 36 $
	"%") echo "0x44 0x20 0x10 0x08 0x44" ;;  # 0x25 37 %
	"&") echo "0x28 0x54 0x54 0x20 0x50" ;;  # 0x26 38 &
	"'") echo "0x06 0x00 0x00 0x00 0x00" ;;  # 0x27 39 '
	"(") echo "0x38 0x44 0x00 0x00 0x00" ;;  # 0x28 40 (
	")") echo "0x44 0x38 0x00 0x00 0x00" ;;  # 0x29 41 )
	"*") echo "0x02 0x07 0x02 0x00 0x00" ;;  # 0x2A 42 *
	"+") echo "0x10 0x10 0x7c 0x10 0x10" ;;  # 0x2B 43 +
	",") echo "0xc0 0x00 0x00 0x00 0x00" ;;  # 0x2C 44 ,
	"-") echo "0x10 0x10 0x10 0x10 0x10" ;;  # 0x2D 45 -
	".") echo "0x40 0x00 0x00 0x00 0x00" ;;  # 0x2E 46 .
	"/") echo "0x60 0x10 0x0c 0x00 0x00" ;;  # 0x2F 47 /
	"0") echo "0x7c 0x64 0x54 0x4c 0x7c" ;;  # 0x30 48 0
	"1") echo "0x48 0x7c 0x40 0x00 0x00" ;;  # 0x31 49 1
	"2") echo "0x64 0x54 0x54 0x54 0x48" ;;  # 0x32 50 2
	"3") echo "0x44 0x54 0x54 0x54 0x6c" ;;  # 0x33 51 3
	"4") echo "0x3c 0x20 0x70 0x20 0x20" ;;  # 0x34 52 4
	"5") echo "0x5c 0x54 0x54 0x54 0x24" ;;  # 0x35 53 5
	"6") echo "0x7c 0x54 0x54 0x54 0x74" ;;  # 0x36 54 6
	"7") echo "0x04 0x04 0x64 0x14 0x0c" ;;  # 0x37 55 7
	"8") echo "0x7c 0x54 0x54 0x54 0x7c" ;;  # 0x38 56 8
	"9") echo "0x5c 0x54 0x54 0x54 0x7c" ;;  # 0x39 57 9
	":") echo "0x44 0x00 0x00 0x00 0x00" ;;  # 0x3A 58 :
	";") echo "0xc4 0x00 0x00 0x00 0x00" ;;  # 0x3B 59 ;
	"<") echo "0x10 0x28 0x44 0x00 0x00" ;;  # 0x3C 60 <
	"=") echo "0x28 0x28 0x28 0x28 0x28" ;;  # 0x3D 61 =
	">") echo "0x44 0x28 0x10 0x00 0x00" ;;  # 0x3E 62 >
	"?") echo "0x08 0x04 0x54 0x08 0x00" ;;  # 0x3F 63 ?
	"@") echo "0x7c 0x44 0x54 0x54 0x5c" ;;  # 0x40 64 @
	"A") echo "0x7c 0x24 0x24 0x24 0x7c" ;;  # 0x41 65 A
	"B") echo "0x7c 0x54 0x54 0x54 0x6c" ;;  # 0x42 66 B
	"C") echo "0x7c 0x44 0x44 0x44 0x44" ;;  # 0x43 67 C
	"D") echo "0x7c 0x44 0x44 0x44 0x38" ;;  # 0x44 68 D
	"E") echo "0x7c 0x54 0x54 0x54 0x44" ;;  # 0x45 69 E
	"F") echo "0x7c 0x14 0x14 0x14 0x04" ;;  # 0x46 70 F
	"G") echo "0x7c 0x44 0x44 0x54 0x74" ;;  # 0x47 71 G
	"H") echo "0x7c 0x10 0x10 0x10 0x7c" ;;  # 0x48 72 H
	"I") echo "0x44 0x44 0x7c 0x44 0x44" ;;  # 0x49 73 I
	"J") echo "0x60 0x40 0x40 0x44 0x7c" ;;  # 0x4A 74 J
	"K") echo "0x7c 0x10 0x10 0x28 0x44" ;;  # 0x4B 75 K
	"L") echo "0x7c 0x40 0x40 0x40 0x40" ;;  # 0x4C 76 L
	"M") echo "0x7c 0x08 0x10 0x08 0x7c" ;;  # 0x4D 77 M
	"N") echo "0x7c 0x08 0x10 0x20 0x7c" ;;  # 0x4E 78 N
	"O") echo "0x38 0x44 0x44 0x44 0x38" ;;  # 0x4F 79 O
	"P") echo "0x7c 0x14 0x14 0x14 0x08" ;;  # 0x50 80 P
	"Q") echo "0x3c 0x24 0x64 0x24 0x3c" ;;  # 0x51 81 Q
	"R") echo "0x7c 0x14 0x14 0x14 0x68" ;;  # 0x52 82 R
	"S") echo "0x5c 0x54 0x54 0x54 0x74" ;;  # 0x53 83 S
	"T") echo "0x04 0x04 0x7c 0x04 0x04" ;;  # 0x54 84 T
	"U") echo "0x7c 0x40 0x40 0x40 0x7c" ;;  # 0x55 85 U
	"V") echo "0x0c 0x30 0x40 0x30 0x0c" ;;  # 0x56 86 V
	"W") echo "0x3c 0x40 0x30 0x40 0x3c" ;;  # 0x57 87 W
	"X") echo "0x44 0x28 0x10 0x28 0x44" ;;  # 0x58 88 X
	"Y") echo "0x0c 0x10 0x60 0x10 0x0c" ;;  # 0x59 89 Y
	"Z") echo "0x44 0x64 0x54 0x4c 0x44" ;;  # 0x5A 90 Z
	"[") echo "0x7c 0x44 0x00 0x00 0x00" ;;  # 0x5B 91 [
	"\\") echo "0x0c 0x10 0x60 0x00 0x00" ;; # 0x5C 92 \
	"]") echo "0x44 0x7c 0x00 0x00 0x00" ;;  # 0x5D 93 ]
	"^") echo "0x00 0x01 0x00 0x01 0x00" ;;  # 0x5E 94 ^
	"_") echo "0x40 0x40 0x40 0x40 0x40" ;;  # 0x5F 95 _
	"\`") echo "0x00 0x01 0x00 0x00 0x00" ;; # 0x60 96 `
	"a") echo "0x7c 0x24 0x24 0x24 0x7c" ;;  # 0x61 97 a
	"b") echo "0x7c 0x54 0x54 0x54 0x6c" ;;  # 0x62 98 b
	"c") echo "0x7c 0x44 0x44 0x44 0x44" ;;  # 0x63 99 c
	"d") echo "0x7c 0x44 0x44 0x44 0x38" ;;  # 0x64 100 d
	"e") echo "0x7c 0x54 0x54 0x54 0x44" ;;  # 0x65 101 e
	"f") echo "0x7c 0x14 0x14 0x14 0x04" ;;  # 0x66 102 f
	"g") echo "0x7c 0x44 0x44 0x54 0x74" ;;  # 0x67 103 g
	"h") echo "0x7c 0x10 0x10 0x10 0x7c" ;;  # 0x68 104 h
	"i") echo "0x44 0x44 0x7c 0x44 0x44" ;;  # 0x69 105 i
	"j") echo "0x60 0x40 0x40 0x44 0x7c" ;;  # 0x6A 106 j
	"k") echo "0x7c 0x10 0x10 0x28 0x44" ;;  # 0x6B 107 k
	"l") echo "0x7c 0x40 0x40 0x40 0x40" ;;  # 0x6C 108 l
	"m") echo "0x7c 0x08 0x10 0x08 0x7c" ;;  # 0x6D 109 m
	"n") echo "0x7c 0x08 0x10 0x20 0x7c" ;;  # 0x6E 110 n
	"o") echo "0x38 0x44 0x44 0x44 0x38" ;;  # 0x6F 111 o
	"p") echo "0x7c 0x14 0x14 0x14 0x08" ;;  # 0x70 112 p
	"q") echo "0x3c 0x24 0x64 0x24 0x3c" ;;  # 0x71 113 q
	"r") echo "0x7c 0x14 0x14 0x14 0x68" ;;  # 0x72 114 r
	"s") echo "0x5c 0x54 0x54 0x54 0x74" ;;  # 0x73 115 s
	"t") echo "0x04 0x04 0x7c 0x04 0x04" ;;  # 0x74 116 t
	"u") echo "0x7c 0x40 0x40 0x40 0x7c" ;;  # 0x75 117 u
	"v") echo "0x0c 0x30 0x40 0x30 0x0c" ;;  # 0x76 118 v
	"w") echo "0x3c 0x40 0x30 0x40 0x3c" ;;  # 0x77 119 w
	"x") echo "0x44 0x28 0x10 0x28 0x44" ;;  # 0x78 120 x
	"y") echo "0x0c 0x10 0x60 0x10 0x0c" ;;  # 0x79 121 y
	"z") echo "0x44 0x64 0x54 0x4c 0x44" ;;  # 0x7A 122 z
	"{") echo "0x10 0x7c 0x44 0x00 0x00" ;;  # 0x7B 123 {
	"|") echo "0x6c 0x00 0x00 0x00 0x00" ;;  # 0x7C 124 |
	"}") echo "0x44 0x7c 0x10 0x00 0x00" ;;  # 0x7D 125 }
	"~") echo "0x02 0x01 0x02 0x01 0x00" ;;  # 0x7E 126 ~
	*) echo "Subarray not defined for '$char'" ;;
	esac
}
oledinit() {
	i2ctransfer -y 0 w6@0x3c 0x80 0xb0 0x80 0x06 0x80 0x12
}

# Function to print subarrays for each character in a string
oledprint() {
	oledinit
	local input_string="$1"
	local i=0
	local result=""
	local echo_char=echo

	while [ "$i" -lt "${#input_string}" ]; do
		local char="${input_string:$i:1}"
		result="$result $(font57 "$char") 0x00"
		i=$((i + 1))
	done

	# Remove trailing space
	result="${result#" "}"
	# echo "$result"

	# echo $((i * 6 + 1))
	i2ctransfer -y 0 w$((i * 6 + 1))@0x3c 0x40 $result
}

oledprint3() {
	oledinit
	local input_string="$1"
	local i=0
	local result=""
	local echo_char=echo

	while [ "$i" -lt "${#input_string}" ]; do
		local char="${input_string:$i:1}"
		result="$result $(font35 "$char") 0x00"
		i=$((i + 1))
	done

	# Remove trailing space
	result="${result#" "}"
	# echo "$result"

	# echo $((i * 4 + 1))
	i2ctransfer -y 0 w$((i * 4 + 1))@0x3c 0x40 $result
}
# TODO: add newline handling, currently we can only print on one line.
```
Paste the shell code to console (qemu geust os console) then execute the following commands:
```shell
# source /root/oled.sh
oledprint3 "    :)    :D    :o   "
#oledprint5 "    :)    :D    :o   "
```
Finally we get the desired result: ![oled 3x5 font](https://github.com/konosubakonoakua/ARM/assets/42881610/eb78dcda-9cb3-44f8-8a6c-657775096687)
